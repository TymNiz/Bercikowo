<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Wyszukiwarka połączeń</title>
  <style>
    body {
      font-family: sans-serif;
      background: #fdfdfd;
      color: #222;
      padding: 20px;
    }
    input, button, select {
      padding: 6px;
      margin: 5px 0;
      font-size: 14px;
    }
    .result {
      border: 1px solid #ccc;
      padding: 10px;
      background: #fff;
      margin-top: 10px;
    }
    h2 {
      border-bottom: 2px solid #ccc;
      padding-bottom: 5px;
    }
    details summary {
      cursor: pointer;
      margin-top: 5px;
      font-weight: bold;
    }
    datalist option {
      font-size: 14px;
    }
    .timetable-line {
      font-family: monospace;
      white-space: pre;
    }
  </style>
</head>
<body>

  <h2>Wyszukiwarka połączeń</h2>

  <label>Stacja początkowa:
    <input type="text" id="startStation" list="stations">
  </label><br>
  <label>Stacja końcowa:
    <input type="text" id="endStation" list="stations">
  </label><br>
  <label>Data podróży: <input type="date" id="travelDate"></label><br>
  <label>Godzina od: <input type="time" id="travelTime"></label><br>
  <button onclick="searchConnections()">Szukaj połączeń</button>

  <datalist id="stations"></datalist>

  <div id="results"></div>
  <a> Powrót </a> <a href="rj26.html"> KLIK </a>

  <script>
    const trains = [
      {
        number: "44300",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Piotrków", arr: null, dep: "05:35" },
          { station: "Wilcza Towarowa", arr: "05:47", dep: "05:48" },
          { station: "Wilcza Miasto", arr: "05:51", dep: "05:52" },
          { station: "Bercikowo Ligota", arr: "05:58", dep: null }
        ]
      },
	  {
        number: "44301",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "06:10" },
          { station: "Wilcza Miasto", arr: "06:16", dep: "06:17" },
          { station: "Wilcza Towarowa", arr: "06:20", dep: "06:21" },
          { station: "Piotrków", arr: "06:33", dep: null }
        ]
      },
	  {
        number: "44302",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Piotrków", arr: null, dep: "07:35" },
          { station: "Wilcza Towarowa", arr: "07:47", dep: "07:48" },
          { station: "Wilcza Miasto", arr: "07:51", dep: "07:52" },
          { station: "Bercikowo Ligota", arr: "07:58", dep: null }
        ]
      },
	  {
        number: "44303",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "08:10" },
          { station: "Wilcza Miasto", arr: "08:16", dep: "08:17" },
          { station: "Wilcza Towarowa", arr: "08:20", dep: "08:21" },
          { station: "Piotrków", arr: "08:33", dep: null }
        ]
      },
	  {
        number: "44304",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Piotrków", arr: null, dep: "09:35" },
          { station: "Wilcza Towarowa", arr: "09:47", dep: "09:48" },
          { station: "Wilcza Miasto", arr: "09:51", dep: "09:52" },
          { station: "Bercikowo Ligota", arr: "09:58", dep: null }
        ]
      },
	  {
        number: "44305",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "10:10" },
          { station: "Wilcza Miasto", arr: "10:16", dep: "10:17" },
          { station: "Wilcza Towarowa", arr: "10:20", dep: "10:21" },
          { station: "Piotrków", arr: "10:33", dep: null }
        ]
      },
	  {
        number: "44306",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Piotrków", arr: null, dep: "11:35" },
          { station: "Wilcza Towarowa", arr: "11:47", dep: "11:48" },
          { station: "Wilcza Miasto", arr: "11:51", dep: "11:52" },
          { station: "Bercikowo Ligota", arr: "11:58", dep: null }
        ]
      },
	  {
        number: "44307",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "12:10" },
          { station: "Wilcza Miasto", arr: "12:16", dep: "12:17" },
          { station: "Wilcza Towarowa", arr: "12:20", dep: "12:21" },
          { station: "Piotrków", arr: "12:33", dep: null }
        ]
      },
	  {
        number: "44308",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Piotrków", arr: null, dep: "13:35" },
          { station: "Wilcza Towarowa", arr: "13:47", dep: "13:48" },
          { station: "Wilcza Miasto", arr: "13:51", dep: "13:52" },
          { station: "Bercikowo Ligota", arr: "13:58", dep: null }
        ]
      },
	  {
        number: "44309",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "14:10" },
          { station: "Wilcza Miasto", arr: "14:16", dep: "14:17" },
          { station: "Wilcza Towarowa", arr: "14:20", dep: "14:21" },
          { station: "Piotrków", arr: "14:33", dep: null }
        ]
      },
	  {
        number: "44310",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Piotrków", arr: null, dep: "15:35" },
          { station: "Wilcza Towarowa", arr: "15:47", dep: "15:48" },
          { station: "Wilcza Miasto", arr: "15:51", dep: "15:52" },
          { station: "Bercikowo Ligota", arr: "15:58", dep: null }
        ]
      },
	  {
        number: "44311",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "16:10" },
          { station: "Wilcza Miasto", arr: "16:16", dep: "16:17" },
          { station: "Wilcza Towarowa", arr: "16:20", dep: "16:21" },
          { station: "Piotrków", arr: "16:33", dep: null }
        ]
      },
	  {
        number: "44312",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Piotrków", arr: null, dep: "17:35" },
          { station: "Wilcza Towarowa", arr: "17:47", dep: "17:48" },
          { station: "Wilcza Miasto", arr: "17:51", dep: "17:52" },
          { station: "Bercikowo Ligota", arr: "17:58", dep: null }
        ]
      },
	  {
        number: "44313",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "18:10" },
          { station: "Wilcza Miasto", arr: "18:16", dep: "18:17" },
          { station: "Wilcza Towarowa", arr: "18:20", dep: "18:21" },
          { station: "Piotrków", arr: "18:33", dep: null }
        ]
      },
	  {
        number: "44314",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Piotrków", arr: null, dep: "19:35" },
          { station: "Wilcza Towarowa", arr: "19:47", dep: "19:48" },
          { station: "Wilcza Miasto", arr: "19:51", dep: "19:52" },
          { station: "Bercikowo Ligota", arr: "19:58", dep: null }
        ]
      },
	  {
        number: "44315",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "20:10" },
          { station: "Wilcza Miasto", arr: "20:16", dep: "20:17" },
          { station: "Wilcza Towarowa", arr: "20:20", dep: "20:21" },
          { station: "Piotrków", arr: "20:33", dep: null }
        ]
      },
	  {
        number: "44316",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Piotrków", arr: null, dep: "21:35" },
          { station: "Wilcza Towarowa", arr: "21:47", dep: "21:48" },
          { station: "Wilcza Miasto", arr: "21:51", dep: "21:52" },
          { station: "Bercikowo Ligota", arr: "21:58", dep: null }
        ]
      },
	  {
        number: "44317",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-7",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "22:10" },
          { station: "Wilcza Miasto", arr: "22:16", dep: "22:17" },
          { station: "Wilcza Towarowa", arr: "22:20", dep: "22:21" },
          { station: "Piotrków", arr: "22:33", dep: null }
        ]
      },
	  {
        number: "44318",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-5",
        stops: [
          { station: "Piotrków", arr: null, dep: "08:35" },
          { station: "Wilcza Towarowa", arr: "08:47", dep: "08:48" },
          { station: "Wilcza Miasto", arr: "08:51", dep: "08:52" },
          { station: "Bercikowo Ligota", arr: "08:58", dep: null }
        ]
      },
	  {
        number: "44319",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-5",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "09:10" },
          { station: "Wilcza Miasto", arr: "09:16", dep: "09:17" },
          { station: "Wilcza Towarowa", arr: "09:20", dep: "09:21" },
          { station: "Piotrków", arr: "09:33", dep: null }
        ]
      },
	  {
        number: "44320",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-5",
        stops: [
          { station: "Piotrków", arr: null, dep: "10:35" },
          { station: "Wilcza Towarowa", arr: "10:47", dep: "10:48" },
          { station: "Wilcza Miasto", arr: "10:51", dep: "10:52" },
          { station: "Bercikowo Ligota", arr: "10:58", dep: null }
        ]
      },
	  {
        number: "44321",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-5",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "11:10" },
          { station: "Wilcza Miasto", arr: "11:16", dep: "11:17" },
          { station: "Wilcza Towarowa", arr: "11:20", dep: "11:21" },
          { station: "Piotrków", arr: "11:33", dep: null }
        ]
      },
	  {
        number: "44322",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-5",
        stops: [
          { station: "Piotrków", arr: null, dep: "14:35" },
          { station: "Wilcza Towarowa", arr: "14:47", dep: "14:48" },
          { station: "Wilcza Miasto", arr: "14:51", dep: "14:52" },
          { station: "Bercikowo Ligota", arr: "14:58", dep: null }
        ]
      },
	  {
        number: "44323",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-5",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "15:10" },
          { station: "Wilcza Miasto", arr: "15:16", dep: "15:17" },
          { station: "Wilcza Towarowa", arr: "15:20", dep: "15:21" },
          { station: "Piotrków", arr: "15:33", dep: null }
        ]
      },
	  {
        number: "44324",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-5",
        stops: [
          { station: "Piotrków", arr: null, dep: "16:35" },
          { station: "Wilcza Towarowa", arr: "16:47", dep: "16:48" },
          { station: "Wilcza Miasto", arr: "16:51", dep: "16:52" },
          { station: "Bercikowo Ligota", arr: "16:58", dep: null }
        ]
      },
	  {
        number: "44325",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-5",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "17:10" },
          { station: "Wilcza Miasto", arr: "17:16", dep: "17:17" },
          { station: "Wilcza Towarowa", arr: "17:20", dep: "17:21" },
          { station: "Piotrków", arr: "17:33", dep: null }
        ]
      },
	  {
        number: "44326",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-5",
        stops: [
          { station: "Piotrków", arr: null, dep: "18:35" },
          { station: "Wilcza Towarowa", arr: "18:47", dep: "18:48" },
          { station: "Wilcza Miasto", arr: "18:51", dep: "18:52" },
          { station: "Bercikowo Ligota", arr: "18:58", dep: null }
        ]
      },
	  {
        number: "44327",
        name: "",
        carrier: "PR - ",
        category: "R",
        days: "1-5",
        stops: [
          { station: "Bercikowo Ligota", arr: null, dep: "19:10" },
          { station: "Wilcza Miasto", arr: "19:16", dep: "19:17" },
          { station: "Wilcza Towarowa", arr: "19:20", dep: "19:21" },
          { station: "Piotrków", arr: "19:33", dep: null }
        ]
      }
    ];

    // Wypełnij datalistę unikalnymi stacjami
    const allStations = Array.from(new Set(trains.flatMap(t => t.stops.map(s => s.station)))).sort();
    const stationList = document.getElementById("stations");
    allStations.forEach(s => {
      const opt = document.createElement("option");
      opt.value = s;
      stationList.appendChild(opt);
    });

    // Domyślna data i godzina
    const today = new Date();
    document.getElementById("travelDate").value = today.toISOString().split("T")[0];
    document.getElementById("travelTime").value = today.toTimeString().substring(0, 5);

    function dayMatches(trainDays, travelDate) {
      const dayOfWeek = travelDate.getDay(); // 0 - niedziela
      const dayMap = { 0: 7, 1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6 };
      const day = dayMap[dayOfWeek];
      if (trainDays.includes(",")) {
        return trainDays.split(",").includes(day.toString());
      }
      const [from, to] = trainDays.split("-").map(Number);
      return day >= from && day <= to;
    }

    function parseTime(t) {
      const [h, m] = t.split(":").map(Number);
      return h * 60 + m;
    }

    function formatTimetable(stops) {
      return stops.map(s => {
        const arr = s.arr ?? "--:--";
        const dep = s.dep ?? "--:--";
        return `<div class="timetable-line">${s.station.padEnd(15)} ${arr}/${dep}</div>`;
      }).join("");
    }

    function searchConnections() {
    const from = document.getElementById("startStation").value.trim();
    const to = document.getElementById("endStation").value.trim();
    const dateInput = document.getElementById("travelDate").value;
    const timeInput = document.getElementById("travelTime").value;
    const results = document.getElementById("results");
    results.innerHTML = "";

    if (!from || !to || !dateInput || !timeInput) {
      results.innerHTML = "<p>Uzupełnij wszystkie pola.</p>";
      return;
    }

    const date = new Date(dateInput);
    const minTime = parseTime(timeInput);

    function findPaths(currentStation, visitedTrains, path, arrivalTime, maxTransfers) {
      if (path.length > maxTransfers + 1) return [];

      const results = [];

      for (const train of trains) {
        if (visitedTrains.includes(train)) continue;
        if (!dayMatches(train.days, date)) continue;

        const stops = train.stops;
        const index = stops.findIndex(s => s.station === currentStation);
        if (index === -1 || index === stops.length - 1) continue;

        for (let i = index + 1; i < stops.length; i++) {
          const depStop = stops[index];
          const arrStop = stops[i];

          const depTime = parseTime(depStop.dep);
          const arrTime = parseTime(arrStop.arr);

          if (path.length === 0 && depTime < minTime) continue;
          if (path.length > 0 && depTime - arrivalTime < 5) continue;

          const newLeg = { train, from: depStop, to: arrStop };

          if (arrStop.station === to) {
            results.push([...path, newLeg]);
          } else {
            const nextPaths = findPaths(arrStop.station, [...visitedTrains, train], [...path, newLeg], arrTime, maxTransfers);
            results.push(...nextPaths);
          }
        }
      }

      return results;
    }

    const allPaths = findPaths(from, [], [], minTime, 6);

    if (allPaths.length === 0) {
      results.innerHTML = "<p>Brak połączeń.</p>";
      return;
    }

    for (const path of allPaths) {
      const firstLeg = path[0];
      const lastLeg = path[path.length - 1];

      let output = `<div class="result">`;
      for (const leg of path) {
        const t = leg.train;
        const trainName = t.name ? ` – ${t.name.toUpperCase()}` : "";
        output += `<strong>${t.carrier} ${t.category} ${t.number}</strong>${trainName}<br>`;
      }

      output += `<strong>${from}</strong>: ${firstLeg.from.dep}<br>`;
      if (path.length > 1) {
        for (let i = 0; i < path.length - 1; i++) {
          const station = path[i].to.station;
          const arr = path[i].to.arr;
          const dep = path[i + 1].from.dep;
          output += `<strong>${station}</strong>: ${arr} / ${dep}<br>`;
        }
      }
      output += `<strong>${to}</strong>: ${lastLeg.to.arr}<br>`;

      output += `<details><summary>Pokaż szczegóły wszystkich kursów</summary>`;
      for (const leg of path) {
        const t = leg.train;
        output += `<em>${t.carrier} ${t.category} ${t.number}</em><br>`;
        output += formatTimetable(t.stops) + "<hr>";
      }
      output += `</details></div>`;

      results.innerHTML += output;
    }
  }
</script>

</body>
</html>
